# Backend AI Guide - Badminton App

This guide provides instructions for AI assistants working on the Spring Boot Java backend.

## Entity Annotations - ALWAYS Use Jakarta

**IMPORTANT**: Always use `jakarta.persistence.*` annotations on all entities. Never use Spring Data annotations (`org.springframework.data.annotation.*` or `org.springframework.data.relational.core.mapping.*`) on entities.

### ✅ Correct - Jakarta annotations
```java
import jakarta.persistence.*;

@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
}
```

### ❌ Wrong - Spring Data annotations
```java
import org.springframework.data.annotation.Id;
import org.springframework.data.relational.core.mapping.Table;

@Table("users")
public class User {
    @Id
    private Long id;
}
```

### Entity Relationship Mapping
Use proper Jakarta relationship annotations:
```java
// OneToMany on parent entity
@OneToMany(mappedBy = "tournament", cascade = CascadeType.ALL, orphanRemoval = true)
private List<TournamentAdmin> admins = new ArrayList<>();

// ManyToOne on child entity
@ManyToOne
@JoinColumn(name = "tournament_id", referencedColumnName = "id")
private Tournament tournament;
```

- Never use `@MappedCollection` (Spring Data JDBC specific)
- Never use `org.springframework.data.annotation.Id`
- Never use `org.springframework.data.relational.core.mapping.Table`
- Never add redundant FK `Long` fields (e.g. `tournamentId`) when a `@ManyToOne` object reference exists
- Always use `jakarta.persistence.*` wildcard import for entities
- Always add `@GeneratedValue(strategy = GenerationType.IDENTITY)` on `@Id` fields
- Always use `JpaRepository<T, ID>` in repositories, not `CrudRepository`
- This project uses **Spring Data JPA** (`spring-boot-starter-data-jpa`), NOT Spring Data JDBC
- Do NOT create documentation .md files unless explicitly requested

## Windows PowerShell Command Syntax

**IMPORTANT**: This project runs on Windows PowerShell, not bash. Use these syntax rules:

- **Command chaining**: Use `;` (semicolon) instead of `&&` (ampersand-ampersand)
  - ❌ Wrong: `cd backend && mvn clean install && mvn spring-boot:run`
  - ✅ Correct: `cd backend; mvn clean install; mvn spring-boot:run`

- **Piping**: Use `|` as normal, but be aware of PowerShell-specific tools
  - ❌ Wrong: Use `tail -20` or `head -10` (these are Unix commands)
  - ✅ Correct: Use PowerShell equivalents like `Select-Object -Last 20`

## Backend Project Structure

```
backend/
├── src/
│   ├── main/
│   │   ├── java/nl/amila/badminton/manager/
│   │   │   └── Application.java        # Main Spring Boot application class
│   │   └── resources/
│   │       ├── application.yaml        # Spring Boot configuration
│   │       ├── static/                 # Static assets served by backend
│   │       └── templates/              # HTML templates (if used)
│   └── test/
│       └── java/nl/amila/badminton/manager/
│           ├── ApplicationTests.java   # Main application tests
│           ├── TestApplication.java    # Test application class
│           └── TestcontainersConfiguration.java
├── pom.xml                             # Maven configuration
├── target/                             # Build output directory
└── mvnw / mvnw.cmd                     # Maven Wrapper (Windows)
```

## Setup and Installation

### First Time Setup
```powershell
cd E:\learn\badminton-app\backend
mvn clean install
```

This:
1. Cleans previous builds
2. Resolves all Maven dependencies
3. Compiles Java source code
4. Runs unit tests
5. Packages application

### Check Java and Maven Versions
```powershell
java -version
mvn --version
```

Recommended:
- Java 21
- Maven 3.6.0 or higher

## Running Commands

### Build the Application
```powershell
cd E:\learn\badminton-app\backend
mvn clean install
```
- Full build with tests
- Creates JAR file in `target/` directory

### Build Without Tests
```powershell
cd E:\learn\badminton-app\backend
mvn clean install -DskipTests
```
- Faster build, skips test execution
- Use only when you're confident in changes

### Run the Application
```powershell
cd E:\learn\badminton-app\backend
mvn spring-boot:run
```
- Starts the Spring Boot application
- Default port: 8098 (see `application.yaml`)
- Serves frontend from `target/dist/` if frontend is built
- Press Ctrl+C to stop

### Run Tests
```powershell
cd E:\learn\badminton-app\backend
mvn test
```
- Runs only unit and integration tests
- Useful for validation before builds

### Clean Build Artifacts
```powershell
cd E:\learn\badminton-app\backend
mvn clean
```
- Removes `target/` directory
- Good before committing or when troubleshooting

## Critical Files

### pom.xml
Maven project configuration. Contains:
- Project metadata
- Dependencies and their versions
- Build plugins and configurations
- Properties (like Java version, project encoding)

**Important properties to check**:
- `java.version` - Java version (set to 21 in the backend module)
- `project.build.sourceEncoding` - Character encoding

### application.yaml
Spring Boot configuration:
- Server port (default: 8098)
- Database connection settings
- Logging configuration
- Custom application properties

Key settings:
```yaml
server:
  port: 8098              # Backend runs on this port
  
spring:
  application:
    name: badminton-manager
```

### Application.java
Main Spring Boot entry point. Contains:
```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

Do not modify unless adding startup configuration.

## Common Issues and Solutions

### Issue: Port 8098 already in use
**Error**: `Port 8098 is already in use`
**Solution**:
1. Find and kill the process using port 8098:
   ```powershell
   Get-NetTCPConnection -LocalPort 8098
   Stop-Process -Id [PID] -Force
   ```
2. Or change port in `application.yaml`:
   ```yaml
   server:
     port: 8099
   ```
3. Update frontend proxy configuration in `frontend/vue.config.js` to match

### Issue: Maven build fails - "BUILD FAILURE"
**Possible causes**:
1. Tests failing - check test output
2. Missing dependencies - check internet connection
3. Java version mismatch - check Java version
4. Corrupted Maven cache - clear cache:
   ```powershell
   Remove-Item $env:USERPROFILE\.m2\repository -Recurse -Force
   mvn clean install
   ```

### Issue: Dependencies won't download
**Solution**:
1. Check internet connection
2. Update Maven:
   ```powershell
   mvn --version
   ```
3. Use local repository mirror if behind corporate proxy
4. Try again - temporary network issues are common

### Issue: Application starts but won't respond to requests
**Check**:
1. Application actually started - look for "Started Application in X.XXX seconds"
2. Correct port in browser/API calls (8098)
3. Check `application.yaml` for configuration errors
4. Check server logs for errors

## Frontend Integration

The backend serves the frontend:
1. Frontend builds to `../frontend/target/dist/`
2. Backend Spring Boot includes this in classpath
3. When backend starts, it serves frontend as static content
4. Browser loads `index.html` from backend
5. Vue Router handles routing on client side
6. API calls to `/api/*` endpoints are handled by backend Java code

**Important**: After building frontend, restart backend to serve latest version.

## Database Setup (if applicable)

Check `application.yaml` for database configuration:
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/badminton
    username: root
    password: password
  jpa:
    hibernate:
      ddl-auto: update
```

Ensure database is running before starting backend.

## Testing

### Run All Tests
```powershell
cd E:\learn\badminton-app\backend
mvn test
```

### Run Specific Test
```powershell
cd E:\learn\badminton-app\backend
mvn test -Dtest=ApplicationTests
```

### Run Tests with Maven During Build
Tests run automatically during `mvn clean install`.

## Dependencies Management

Key Spring Boot Starters (from pom.xml):
- `spring-boot-starter-web` - Web application support
- `spring-boot-starter-data-jpa` - Database ORM
- `spring-boot-starter-test` - Testing framework

Lombok is used to reduce boilerplate in DTOs and entities. Ensure annotation processing is enabled in your IDE.

When adding dependencies:
1. Update pom.xml with new dependency
2. Run `mvn clean install`
3. Test application: `mvn spring-boot:run`
4. Run tests: `mvn test`

## Debugging

### Enable Debug Logging
In `application.yaml`:
```yaml
logging:
  level:
    root: INFO
    nl.amila.badminton: DEBUG
```

### Run in Debug Mode
```powershell
cd E:\learn\badminton-app\backend
mvn spring-boot:run -Dspring-boot.run.jvmArguments="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005"
```

Connect IDE debugger to `localhost:5005`.

## Build Output

After successful build:
- JAR file: `target/badminton-manager-0.0.1-SNAPSHOT.jar` (example name)
- Classes: `target/classes/`
- Test results: `target/surefire-reports/`

## Maven Wrapper

Use `mvnw.cmd` instead of `mvn` command if Maven is not in PATH:
```powershell
cd E:\learn\badminton-app\backend
.\mvnw.cmd clean install
```

This uses the bundled Maven wrapper.

## Performance Considerations

### Build Speed
- Full build: `mvn clean install` (slowest, includes tests)
- Quick build: `mvn clean install -DskipTests` (faster, skips tests)
- Incremental: `mvn install` (fastest, uses existing target)

### Memory Usage
For large projects, increase Maven memory:
```powershell
$env:MAVEN_OPTS = "-Xmx1024m"
mvn clean install
```

## Troubleshooting Commands

```powershell
# Show Maven version and active profile
mvn --version

# Show dependency tree
mvn dependency:tree

# Find dependency conflicts
mvn dependency:tree -Dverbose

# Check for outdated plugins
mvn versions:display-plugin-updates

# Check for outdated dependencies
mvn versions:display-dependency-updates
```

## Deployment

### Create Executable JAR
```powershell
cd E:\learn\badminton-app\backend
mvn clean install
```

JAR file location: `target/badminton-manager-*.jar`

### Run JAR File
```powershell
java -jar target/badminton-manager-*.jar
```

### Docker Deployment
See root `Dockerfile` for containerization instructions.

## Getting Help

When asking for help:
1. Always provide the error message and stack trace
2. Run `mvn clean install` to reproduce if possible
3. Share relevant parts of `pom.xml`
4. Mention Java version: `java -version`
5. Mention Maven version: `mvn --version`
6. Reference the root `.ai-guide.md` for general project structure
7. Check `application.yaml` for configuration issues

## Root Project Configuration

The root `pom.xml` contains parent configuration for both frontend and backend:
- Maven plugins
- Shared properties
- Build profiles

Check root pom.xml if build issues affect entire project.

